<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="Content-Style-Type" content="text/css">
    <title></title>
    <meta name="Generator" content="Cocoa HTML Writer">
    <meta name="CocoaVersion" content="1504.82">
    <style type="text/css">
        body {background-color: #ff0000}
        span.s1 {font-kerning: none; background-color: #ffff00}
    </style>
</head>
<body>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; line-height: 28.0px; font: 24.0px Times; color: #000000; -webkit-text-stroke: #000000"><span class="s1"><b>Todos</b></span></h1>
<!--<button onclick="window.open('file:///Users/vladimir.gordeev/Downloads/close.html')">open</button><br>-->
<button id="openButton">open</button><br>
<button id="sendButton">отправить сообщение</button><input id='msg' type="text"/><br>
<button onclick="window.close()">close</button>
<br><br>
<div id="field">
    поле для переписки
</div>


<script>
    var PATH = 'file:///Users/dmitrylapynov/odkl/ok-applications/api-test-app/chat.html';
    var openButton = document.getElementById('openButton');
    var sendButton = document.getElementById('sendButton');
    var field = document.getElementById('field');
    var msg = document.getElementById('msg');
    var child = null;

    openButton.addEventListener('click', function () {
        child = window.open(PATH);
        console.log('opened', child)
    });
    
    sendButton.addEventListener('click', function () {
        var target = window.opener || child;
        if (target) {
            target.postMessage({text: msg.value}, "*");
        } else {
            alert('Нет таргета');
        }
    });

    window.addEventListener('message', function (e) {
        if (e.data && e.data.text) {
            var span = document.createElement('SPAN');
            span.innerHTML = e.data.text;
            field.appendChild(span)
        }

        console.log('recieved a message: ', e);
    });

</script>

</body>
</html>